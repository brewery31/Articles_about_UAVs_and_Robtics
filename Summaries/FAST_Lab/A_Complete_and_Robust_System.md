# Teach-Repeat-Replan系统总结

## 一、系统概述

Teach-Repeat-Replan是一个完整的自主四旋翼无人机系统，旨在复杂环境中实现激进飞行。该系统基于经典的"教学-重复"框架，但通过创新方法解决了传统系统在轨迹生成和环境适应性方面的局限性。



## 二、核心创新点

1. **轨迹转换方法**：将人类操控的任意抖动轨迹自动转换为拓扑等效的平滑、安全且动力学可行的轨迹，同时保留人类期望的飞行激进程度。

2. **飞行走廊生成**：相比之前使用轴对齐立方体的方法，新系统能生成更通用的自由大凸多面体，显著增加了优化自由度。

3. **局部重规划**：集成了快速局部感知方法和滑动窗口重规划方法，可在飞行中生成安全且动力学可行的局部轨迹以避开未映射或移动障碍物。

## 三、系统架构

### 硬件配置
- 使用Intel RealSense2立体摄像头对进行深度感知
- DJI N3自动驾驶仪用于稳定无人机并提供IMU数据
- DJI Manifold 2-C用于机载计算
- DJI Lightbridge2用于手动操控和远程监控



### 软件架构
1. **全局定位与建图**：使用VINS框架进行视觉惯性里程计(VIO)定位，结合闭环检测和全局位姿图优化。

2. **全局时空规划**：
   - 空间轨迹优化：使用Bernstein基表示轨迹为分段Bézier曲线
   - 时间轨迹优化：设计重定时函数t(τ)来优化时间分配

3. **局部碰撞避免**：
   - 使用FIESTA框架构建局部欧几里得符号距离场(ESDF)
   - 基于梯度的B样条优化进行局部重规划



## 四、关键技术细节

### 1. 飞行走廊生成
系统提出了一种基于凸集聚类的方法来生成自由大凸多面体：

- **算法核心**：通过膨胀凸体簇来找到给定坐标处最大的自由凸多面体
- **CPU加速**：采用多面体初始化、提前终止和顶点选择等技术
- **GPU加速**：利用并行计算方案显著提高计算速度



### 2. 时空轨迹优化
采用坐标下降框架交替优化空间和时间轨迹：

- **空间优化**：最小化Bézier曲线的三阶导数(急动度)
- **时间优化**：将问题转化为二阶锥规划(SOCP)求解
- **边界约束**：确保轨迹的起始和结束状态
- **连续性约束**：保证轨迹分段连接处的平滑性

### 3. 局部重规划
基于B样条的弹性带优化方法：

- **B样条初始化**：将局部轨迹初始化为均匀B样条
- **优化目标**：包含平滑度、安全性和动力学可行性
- **迭代细化**：通过调整时间参数化来消除动力学不可行性



## 五、实验验证

系统在多种场景下进行了验证：

1. **模拟飞行测试**：在随机部署各种障碍物的模拟环境中测试全局和局部规划方法。

2. **基准比较**：
   - 走廊生成：GPU加速版本在精细分辨率(0.075m)下比CPU原始版本快30倍
   - 全局规划：相比梯度法和航点法，提出的方法在所有长度、时间和能量指标上都表现更优

3. **室内飞行测试**：
   - 静态环境：在直径仅0.6m的狭窄圆环中实现激进飞行
   - 动态环境：成功避开移动和新增障碍物

4. **室外飞行测试**：在自然环境中实现高达7m/s的高速自主飞行



## 六、系统优势

1. **完整性**：提供从教学到重复再到重规划的完整解决方案
2. **鲁棒性**：能够处理环境变化和定位漂移
3. **灵活性**：适应从无人机竞速到航空摄影的不同激进程度需求
4. **开源**：所有组件都作为开源ROS软件包发布

## 七、未来工作方向

1. **视点规划**：研究考虑定位不确定性和地图约束的最优视点规划
2. **全向感知**：改进系统在有限感知能力下的导航性能
3. **参数自适应**：开发重规划参数的自动调整机制